# 数控设备信息管理系统 (Vue3 + Flask)

## 项目结构

```
oee-system/
├── backend/              # Flask后端
│   ├── app.py            # 主应用文件
│   ├── models.py         # 数据模型
│   ├── requirements.txt  # 依赖文件
│   └── data/             # 数据库文件
├── frontend/             # Vue3前端
│   ├── public/
│   ├── src/
│   │   ├── assets/
│   │   ├── components/
│   │   ├── views/
│   │   ├── App.vue
│   │   └── main.js
│   ├── package.json
│   └── vite.config.js
└── README.md
```

## 后端实现 (Flask)

### 1. 安装依赖 (requirements.txt)

```text
Flask==2.3.2
Flask-SQLAlchemy==3.0.3
Flask-Cors==3.0.10
python-dotenv==1.0.0
```

### 2. 数据模型 (models.py)

```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class Device(db.Model):
    __tablename__ = 'devices'
    
    device_id = db.Column(db.String(20), primary_key=True)
    type = db.Column(db.String(50))
    model = db.Column(db.String(50))
    spec = db.Column(db.Text)
    purchase_date = db.Column(db.Date)
    status = db.Column(db.String(20))
    
    def to_dict(self):
        return {
            'device_id': self.device_id,
            'type': self.type,
            'model': self.model,
            'spec': self.spec,
            'purchase_date': str(self.purchase_date),
            'status': self.status
        }

class OperationLog(db.Model):
    __tablename__ = 'operation_logs'
    
    log_id = db.Column(db.Integer, primary_key=True)
    device_id = db.Column(db.String(20), db.ForeignKey('devices.device_id'))
    date = db.Column(db.Date)
    operator = db.Column(db.String(50))
    runtime = db.Column(db.Float)
    output = db.Column(db.Integer)
    
    def to_dict(self):
        return {
            'log_id': self.log_id,
            'device_id': self.device_id,
            'date': str(self.date),
            'operator': self.operator,
            'runtime': self.runtime,
            'output': self.output
        }

class RepairRecord(db.Model):
    __tablename__ = 'repair_records'
    
    repair_id = db.Column(db.Integer, primary_key=True)
    device_id = db.Column(db.String(20), db.ForeignKey('devices.device_id'))
    fault_date = db.Column(db.Date)
    description = db.Column(db.Text)
    solution = db.Column(db.Text)
    cost = db.Column(db.Float)
    
    def to_dict(self):
        return {
            'repair_id': self.repair_id,
            'device_id': self.device_id,
            'fault_date': str(self.fault_date),
            'description': self.description,
            'solution': self.solution,
            'cost': self.cost
        }
```

### 3. Flask应用 (app.py)

```python
from flask import Flask, jsonify, request
from flask_cors import CORS
from models import db, Device, OperationLog, RepairRecord
import os

app = Flask(__name__)
CORS(app)

# 配置数据库
basedir = os.path.abspath(os.path.dirname(__file__))
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///' + os.path.join(basedir, 'data/device.db')
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False

db.init_app(app)

# 初始化数据库
@app.before_first_request
def create_tables():
    db.create_all()

# 设备管理接口
@app.route('/api/devices', methods=['GET', 'POST'])
def devices():
    if request.method == 'GET':
        devices = Device.query.all()
        return jsonify([d.to_dict() for d in devices])
    else:
        data = request.get_json()
        device = Device(
            device_id=data['device_id'],
            type=data['type'],
            model=data['model'],
            spec=data['spec'],
            purchase_date=data['purchase_date'],
            status=data['status']
        )
        db.session.add(device)
        db.session.commit()
        return jsonify(device.to_dict())

@app.route('/api/devices/<device_id>', methods=['GET', 'PUT', 'DELETE'])
def device(device_id):
    device = Device.query.get_or_404(device_id)
    if request.method == 'GET':
        return jsonify(device.to_dict())
    elif request.method == 'PUT':
        data = request.get_json()
        device.type = data['type']
        device.model = data['model']
        device.spec = data['spec']
        device.purchase_date = data['purchase_date']
        device.status = data['status']
        db.session.commit()
        return jsonify(device.to_dict())
    else:
        db.session.delete(device)
        db.session.commit()
        return jsonify({'message': 'Device deleted'})

# 运行记录接口
@app.route('/api/logs', methods=['GET', 'POST'])
def logs():
    if request.method == 'GET':
        logs = OperationLog.query.all()
        return jsonify([l.to_dict() for l in logs])
    else:
        data = request.get_json()
        log = OperationLog(
            device_id=data['device_id'],
            date=data['date'],
            operator=data['operator'],
            runtime=data['runtime'],
            output=data['output']
        )
        db.session.add(log)
        db.session.commit()
        return jsonify(log.to_dict())

# 维修记录接口
@app.route('/api/repairs', methods=['GET', 'POST'])
def repairs():
    if request.method == 'GET':
        repairs = RepairRecord.query.all()
        return jsonify([r.to_dict() for r in repairs])
    else:
        data = request.get_json()
        repair = RepairRecord(
            device_id=data['device_id'],
            fault_date=data['fault_date'],
            description=data['description'],
            solution=data['solution'],
            cost=data['cost']
        )
        db.session.add(repair)
        db.session.commit()
        return jsonify(repair.to_dict())

if __name__ == '__main__':
    app.run(debug=True)
```

## 前端实现 (Vue3)

### 1. 创建Vue项目

```bash
npm create vue@latest frontend
cd frontend
npm install axios vue-router
```

### 2. 主要组件

#### 设备列表 (DeviceList.vue)

```vue
<template>
  <div>
    <h2>设备列表</h2>
    <button @click="showAddDialog = true">添加设备</button>
    
    <table>
      <thead>
        <tr>
          <th>设备编号</th>
          <th>类型</th>
          <th>型号</th>
          <th>状态</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="device in devices" :key="device.device_id">
          <td>{{ device.device_id }}</td>
          <td>{{ device.type }}</td>
          <td>{{ device.model }}</td>
          <td>{{ device.status }}</td>
          <td>
            <button @click="editDevice(device)">编辑</button>
            <button @click="deleteDevice(device.device_id)">删除</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- 添加/编辑设备对话框 -->
    <dialog v-if="showAddDialog">
      <h3>{{ editing ? '编辑设备' : '添加设备' }}</h3>
      <form @submit.prevent="submitDevice">
        <label>设备编号: <input v-model="form.device_id" required></label>
        <label>类型: <input v-model="form.type" required></label>
        <label>型号: <input v-model="form.model" required></label>
        <label>规格: <textarea v-model="form.spec"></textarea></label>
        <label>购买日期: <input type="date" v-model="form.purchase_date" required></label>
        <label>状态: 
          <select v-model="form.status">
            <option value="运行中">运行中</option>
            <option value="停机">停机</option>
            <option value="维修中">维修中</option>
          </select>
        </label>
        <button type="submit">保存</button>
        <button type="button" @click="showAddDialog = false">取消</button>
      </form>
    </dialog>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

const devices = ref([])
const showAddDialog = ref(false)
const editing = ref(false)
const form = ref({
  device_id: '',
  type: '',
  model: '',
  spec: '',
  purchase_date: '',
  status: '运行中'
})

const fetchDevices = async () => {
  const response = await axios.get('http://localhost:5000/api/devices')
  devices.value = response.data
}

const editDevice = (device) => {
  editing.value = true
  form.value = { ...device }
  showAddDialog.value = true
}

const submitDevice = async () => {
  if (editing.value) {
    await axios.put(`http://localhost:5000/api/devices/${form.value.device_id}`, form.value)
  } else {
    await axios.post('http://localhost:5000/api/devices', form.value)
  }
  showAddDialog.value = false
  fetchDevices()
}

const deleteDevice = async (id) => {
  if (confirm('确定删除此设备吗？')) {
    await axios.delete(`http://localhost:5000/api/devices/${id}`)
    fetchDevices()
  }
}

onMounted(() => {
  fetchDevices()
})
</script>

<style scoped>
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
}
tr:nth-child(even) {
  background-color: #f2f2f2;
}
dialog {
  width: 500px;
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 5px;
}
</style>
```

#### 运行记录 (OperationLog.vue)

```vue
<template>
  <div>
    <h2>运行记录</h2>
    <button @click="showAddDialog = true">添加记录</button>
    
    <table>
      <thead>
        <tr>
          <th>记录ID</th>
          <th>设备编号</th>
          <th>日期</th>
          <th>操作员</th>
          <th>运行时间(小时)</th>
          <th>加工件数</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="log in logs" :key="log.log_id">
          <td>{{ log.log_id }}</td>
          <td>{{ log.device_id }}</td>
          <td>{{ log.date }}</td>
          <td>{{ log.operator }}</td>
          <td>{{ log.runtime }}</td>
          <td>{{ log.output }}</td>
        </tr>
      </tbody>
    </table>

    <!-- 添加记录对话框 -->
    <dialog v-if="showAddDialog">
      <h3>添加运行记录</h3>
      <form @submit.prevent="submitLog">
        <label>设备编号: 
          <select v-model="logForm.device_id" required>
            <option v-for="device in devices" :value="device.device_id">{{ device.device_id }}</option>
          </select>
        </label>
        <label>日期: <input type="date" v-model="logForm.date" required></label>
        <label>操作员: <input v-model="logForm.operator" required></label>
        <label>运行时间(小时): <input type="number" step="0.1" v-model="logForm.runtime" required></label>
        <label>加工件数: <input type="number" v-model="logForm.output" required></label>
        <button type="submit">保存</button>
        <button type="button" @click="showAddDialog = false">取消</button>
      </form>
    </dialog>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

const logs = ref([])
const devices = ref([])
const showAddDialog = ref(false)
const logForm = ref({
  device_id: '',
  date: '',
  operator: '',
  runtime: 0,
  output: 0
})

const fetchLogs = async () => {
  const response = await axios.get('http://localhost:5000/api/logs')
  logs.value = response.data
}

const fetchDevices = async () => {
  const response = await axios.get('http://localhost:5000/api/devices')
  devices.value = response.data
}

const submitLog = async () => {
  await axios.post('http://localhost:5000/api/logs', logForm.value)
  showAddDialog.value = false
  fetchLogs()
}

onMounted(() => {
  fetchLogs()
  fetchDevices()
})
</script>
```

#### 维修记录 (RepairRecord.vue)

```vue
<template>
  <div>
    <h2>维修记录</h2>
    <button @click="showAddDialog = true">添加记录</button>
    
    <table>
      <thead>
        <tr>
          <th>维修单号</th>
          <th>设备编号</th>
          <th>故障日期</th>
          <th>故障描述</th>
          <th>维修费用</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="repair in repairs" :key="repair.repair_id">
          <td>{{ repair.repair_id }}</td>
          <td>{{ repair.device_id }}</td>
          <td>{{ repair.fault_date }}</td>
          <td>{{ repair.description }}</td>
          <td>{{ repair.cost }}</td>
        </tr>
      </tbody>
    </table>

    <!-- 添加记录对话框 -->
    <dialog v-if="showAddDialog">
      <h3>添加维修记录</h3>
      <form @submit.prevent="submitRepair">
        <label>设备编号: 
          <select v-model="repairForm.device_id" required>
            <option v-for="device in devices" :value="device.device_id">{{ device.device_id }}</option>
          </select>
        </label>
        <label>故障日期: <input type="date" v-model="repairForm.fault_date" required></label>
        <label>故障描述: <textarea v-model="repairForm.description" required></textarea></label>
        <label>解决方案: <textarea v-model="repairForm.solution" required></textarea></label>
        <label>维修费用: <input type="number" step="0.01" v-model="repairForm.cost" required></label>
        <button type="submit">保存</button>
        <button type="button" @click="showAddDialog = false">取消</button>
      </form>
    </dialog>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

const repairs = ref([])
const devices = ref([])
const showAddDialog = ref(false)
const repairForm = ref({
  device_id: '',
  fault_date: '',
  description: '',
  solution: '',
  cost: 0
})

const fetchRepairs = async () => {
  const response = await axios.get('http://localhost:5000/api/repairs')
  repairs.value = response.data
}

const fetchDevices = async () => {
  const response = await axios.get('http://localhost:5000/api/devices')
  devices.value = response.data
}

const submitRepair = async () => {
  await axios.post('http://localhost:5000/api/repairs', repairForm.value)
  showAddDialog.value = false
  fetchRepairs()
}

onMounted(() => {
  fetchRepairs()
  fetchDevices()
})
</script>
```

#### 主应用 (App.vue)

```vue
<template>
  <div>
    <h1>数控设备信息管理系统</h1>
    <nav>
      <router-link to="/devices">设备管理</router-link> |
      <router-link to="/logs">运行记录</router-link> |
      <router-link to="/repairs">维修记录</router-link>
    </nav>
    <router-view></router-view>
  </div>
</template>

<script setup>
import { RouterLink, RouterView } from 'vue-router'
</script>

<style>
nav {
  padding: 1rem;
  background: #f0f0f0;
  margin-bottom: 1rem;
}
nav a {
  margin: 0 0.5rem;
  text-decoration: none;
  color: #333;
}
nav a.router-link-active {
  color: #42b983;
  font-weight: bold;
}
</style>
```

### 3. 路由配置 (router.js)

```javascript
import { createRouter, createWebHistory } from 'vue-router'
import DeviceList from './components/DeviceList.vue'
import OperationLog from './components/OperationLog.vue'
import RepairRecord from './components/RepairRecord.vue'

const routes = [
  { path: '/', redirect: '/devices' },
  { path: '/devices', component: DeviceList },
  { path: '/logs', component: OperationLog },
  { path: '/repairs', component: RepairRecord }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

### 4. 主入口 (main.js)

```javascript
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import axios from 'axios'

axios.defaults.baseURL = 'http://localhost:5000'

const app = createApp(App)
app.use(router)
app.mount('#app')
```

## 运行说明

1. 启动后端服务：
```bash
cd backend
pip install -r requirements.txt
python app.py
```

2. 启动前端服务：
```bash
cd frontend
npm install
npm run dev
```

3. 访问应用：
```
http://localhost:5173
```

## 功能说明

1. **设备管理**：
   - 查看设备列表
   - 添加/编辑/删除设备
   - 查看设备详细信息

2. **运行记录**：
   - 记录设备每日运行情况
   - 查看历史运行记录

3. **维修记录**：
   - 记录设备维修情况
   - 查看维修历史

系统实现了完整的CRUD操作，前后端分离架构，适合作为课程设计项目。